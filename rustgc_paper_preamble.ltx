\documentclass[acmsmall,screen,review]{acmart}
\settopmatter{printfolios=true,printccs=false,printacmref=false}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\usepackage{booktabs}
\usepackage{courier}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{listings-rust}
\usepackage{microtype}
\usepackage{multicol}
\usepackage{multirow}
\usepackage{pdflscape}
\usepackage{softdev}
\usepackage{subcaption}
\usepackage{tikz}
\usepackage{xspace}

% Must be loaded last
\usepackage[capitalise]{cleveref}

\usetikzlibrary{automata, positioning, arrows}

\lstset{
    xleftmargin=0pt,
    numbersep=.8em,
    numberstyle=\scriptsize\tiny,
    basicstyle=\ttfamily\small,
    captionpos=b,
    escapeinside={{<!}{!>}},
    numbers=left,
    xleftmargin=15pt,
}

\lstnewenvironment{lstrustsmall}[1][]
  {
      \lstset{
          language=Rust,
          style=colouredRust,
          xleftmargin=0pt,
          numbersep=.8em,
          numberstyle=\scriptsize\tiny,
          basicstyle=\ttfamily\small,
          captionpos=b,
          escapeinside={{<!}{!>}},
          numbers=left,
          xleftmargin=15pt,
          }
}{}

\lstnewenvironment{lstrustsmallnonums}[1][]
  {
      \lstset{
          language=Rust,
          style=colouredRust,
          xleftmargin=0pt,
          numbersep=.8em,
          numberstyle=\scriptsize\tiny,
          basicstyle=\ttfamily\small,
          captionpos=b,
          escapeinside={{<!}{!>}},
          numbers=none,
          xleftmargin=15pt,
          }
}{}

% from https://tex.stackexchange.com/questions/264361/skipping-line-numbers-in-lstlisting#264373
\let\origthelstnumber\thelstnumber
\makeatletter
\newcommand*\Suppressnumber{%
  \lst@AddToHook{OnNewLine}{%
    \let\thelstnumber\relax%
     \advance\c@lstnumber-\@ne\relax%
    }%
}
\newtheorem{definition}{Definition}

% Algorithm macros
\algnewcommand\algorithmicforeach{\textbf{for each}}
\algdef{S}[FOR]{ForEach}[1]{\algorithmicforeach\ #1\ \algorithmicdo}
\algnewcommand{\algorithmicand}{\textbf{and }}
\algnewcommand{\algorithmicor}{\textbf{or }}
\algnewcommand{\algorithmicnot}{\textbf{not }}
\algnewcommand{\NOT}{\algorithmicnot}
\algnewcommand{\OR}{\algorithmicor}
\algnewcommand{\AND}{\algorithmicand}

\newcommand\boehm{\textsc{BDWGC}\xspace}
\newcommand\rustbacon{\textsc{Bacon-Rajan-CC}\xspace}
\newcommand\rustc{\lstinline{rustc}\xspace}
\newcommand\rustgc{\textsc{Rust-GC}\xspace}
\newcommand\bronze{\textsc{Bronze}\xspace}
\newcommand\ourgc{\textsc{Alloy}\xspace}
\newcommand\shifgrethor{\textsc{Shifgrethor}\xspace}
\newcommand\gcarena{\textsc{gc-arena}\xspace}
\newcommand\bor{borrow-or-finalise rule\xspace}

\newcommand\somrs{\textsc{som-rs}\xspace}
\newcommand\somrsrc{\textsc{rc$_{\textrm{jemalloc}}$}\xspace}
\newcommand\somrsrcbdwgc{\textsc{rc$_{\textrm{bdwgcalloc}}$}\xspace}
\newcommand\somrsgc{\textsc{gc}\xspace}
\newcommand\wlambda{\textsc{WLambda}\xspace}
\newcommand\wlambdaarc{\textsc{WLambda-arc}\xspace}
\newcommand\wlambdaalloy{\textsc{WLambda-alloy}\xspace}
\newcommand\yksom{\textsc{yksom}\xspace}
\newcommand\yksomnaive{\textsc{YKSOM$_{\textrm{Naive}}$}\xspace}
\newcommand\yksomelision{\textsc{YKSOM$_{\textrm{FinaliserElision}}$}\xspace}
\newcommand\yksomnobarriers{\textsc{BarriersNone}\xspace}
\newcommand\yksomallbarriers{\textsc{BarriersAll}\xspace}
\newcommand\yksomoptbarriers{\textsc{BarriersOpt}\xspace}
\newcommand\perf{\textsc{perf}\xspace}
\newcommand\mem{\textsc{mem}\xspace}

\title{Garbage Collection for Rust: The Finaliser Frontier}

\author{Jacob Hughes}
\affiliation{%
  \institution{Software Development Team, King's College London}
  \city{London}
  \country{United Kingdom}}
\email{https://jakehuges.uk/}

\author{Laurence Tratt}
\affiliation{%
  \institution{Software Development Team, King's College London}
  \city{London}
  \country{United Kingdom}}
\email{https://tratt.net/laurie/}
